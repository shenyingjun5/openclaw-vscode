# 斜杠命令选择器设计

## 概述

在输入框输入 `/` 触发的命令选择器，类似 `@` 文件选择器。显示命令、技能和工作流的可搜索列表。

---

## 交互流程

```
用户输入 /
    ↓
显示命令选择器
    ↓
┌────────────────────────────────────┐
│ 🔍 搜索命令或技能...               │
├────────────────────────────────────┤
│ ⚡ 命令                            │
│   /init      重新扫描项目          │
│   /skills    列出所有技能          │
│   /workflow  显示当前工作流        │
│   /clear     清空对话              │
├────────────────────────────────────┤
│ 🎯 技能                            │
│   test       测试, unit test       │
│   review     代码审查, review      │
│   refactor   重构                  │
├────────────────────────────────────┤
│ 📋 工作流                          │
│   .cursorrules                     │
└────────────────────────────────────┘
    ↓
用户选择
    ↓
┌─────────────────────────────────────┐
│ 命令 → 立即执行                     │
│ 技能 → 输入框显示 "/test "          │
│ 工作流 → 输入框显示 "/.cursorrules " │
└─────────────────────────────────────┘
```

---

## 选择行为

| 选择类型 | 行为 | 输入框显示 | 发送时 |
|----------|------|-----------|--------|
| **命令** | 立即执行 | 清空 | - |
| **技能** | 插入到输入框 | `/test ` | 强制使用此技能 |
| **工作流** | 插入到输入框 | `/.cursorrules ` | 强制注入此工作流 |

---

## 发送时消息处理

### 技能前缀

```
用户发送: "/test 帮我写测试"
    ↓
解析: 
  - 前缀: /test
  - 内容: 帮我写测试
    ↓
查找技能 "test"
    ↓
构建消息:
  [Skill: test]
  <技能内容>
  
  [Current workspace: ...]
  
  帮我写测试
```

### 工作流前缀

```
用户发送: "/.cursorrules 开始工作"
    ↓
解析: 
  - 前缀: /.cursorrules
  - 内容: 开始工作
    ↓
读取 .cursorrules 内容
    ↓
构建消息:
  [Project Workflow]
  <.cursorrules 内容>
  
  [Current workspace: ...]
  
  开始工作
```

---

## 命令列表

| 命令 | 功能 |
|------|------|
| `/init` | 重新扫描项目 |
| `/skills` | 列出所有技能 |
| `/workflow` | 显示当前工作流 |
| `/clear` | 清空对话 |

---

## 键盘交互

| 按键 | 行为 |
|-----|------|
| `↑` / `↓` | 上下移动选择 |
| `Enter` | 确认选择 |
| `Escape` | 关闭弹窗 |
| 继续输入 | 过滤列表 |
| `Backspace` 删除 `/` | 关闭弹窗 |

---

## 边界情况

| 场景 | 处理方式 |
|------|---------|
| 项目无技能/工作流 | 只显示命令 |
| `/` 后继续输入 | 实时过滤列表 |
| `/xxx` 无匹配 | 作为普通消息发送 |
| 输入框有内容时按 `/` | 在光标位置插入 |

---

## 修改的文件

```
webview/
├── index.html       # 添加 slash-picker HTML
├── styles.css       # 添加 slash-picker 样式
└── main.js          # 添加 slash-picker 逻辑

src/
├── chatPanel.ts     # 解析 /skill 前缀, 发送项目状态
└── chatProvider.ts  # 解析 /skill 前缀, 发送项目状态
```

---

## 实现阶段

| 阶段 | 任务 | 工时 |
|-----|------|-----|
| 1 | HTML: 添加 slash-picker 弹窗 | 0.5h |
| 2 | CSS: 弹窗样式 (复用 file-picker) | 0.5h |
| 3 | JS: 监听 `/` 输入, 显示弹窗 | 0.5h |
| 4 | JS: 渲染命令/技能/工作流列表 | 1h |
| 5 | JS: 搜索过滤 | 0.5h |
| 6 | JS: 选择处理 (执行 vs 插入) | 1h |
| 7 | TS: 解析 `/skillname` 前缀 | 1h |
| 8 | TS: 强制应用指定技能/工作流 | 1h |

**预计总工时: ~6 小时**
