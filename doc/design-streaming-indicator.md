# è®¾è®¡æ–¹æ¡ˆï¼šAI å›å¤æœŸé—´åº•éƒ¨æ³¢åŠ¨æŒ‡ç¤ºå™¨

## ç°çŠ¶

å½“å‰æ’ä»¶åœ¨ AI å›å¤æœŸé—´æ˜¾ç¤ºä¸€ä¸ª"æ­£åœ¨æ€è€ƒ"æŒ‡ç¤ºå™¨ï¼š
- ä¸‰ä¸ªåœ†ç‚¹ä¸Šä¸‹è·³åŠ¨ + "æ‹›è´¢æ­£åœ¨æ€è€ƒ..." æ–‡å­—
- `showThinking()` åœ¨å‘é€æ¶ˆæ¯æ—¶è°ƒç”¨
- `hideThinking()` åœ¨æ”¶åˆ°å›å¤ / é”™è¯¯ / å†å²åŠ è½½åè°ƒç”¨
- ä½äºæ¶ˆæ¯åˆ—è¡¨æœ€åº•éƒ¨

**é—®é¢˜**ï¼šæŒ‡ç¤ºå™¨å¤ªç®€å•ï¼Œåƒä¸ªé™æ€çŠ¶æ€æ–‡å­—ï¼Œç¼ºå°‘"æ­£åœ¨æŒç»­è¾“å‡º"çš„æµç•…æ„Ÿã€‚

## Webchat çš„åšæ³•

Webchat æœ‰ä¸¤ç§æŒ‡ç¤ºå™¨ï¼Œå¯¹åº”ä¸åŒé˜¶æ®µï¼š

### 1. Reading Indicatorï¼ˆç­‰å¾…å¼€å§‹ï¼‰
- ä¸‰ä¸ªåœ†ç‚¹è„‰å†²åŠ¨ç”»ï¼ˆ`chatReadingDot` åŠ¨ç”»ï¼‰
- åœ¨ AI è¿˜æ²¡å¼€å§‹è¾“å‡ºæ–‡å­—æ—¶æ˜¾ç¤º
- æ¡ä»¶ï¼š`stream !== null && stream.trim() === ''`ï¼ˆæœ‰ stream ä½†å†…å®¹ä¸ºç©ºï¼‰
- æ”¾åœ¨ä¸€ä¸ª `chat-bubble` å®¹å™¨é‡Œï¼Œå¸¦ AI å¤´åƒ

### 2. Streaming Indicatorï¼ˆæ­£åœ¨è¾“å‡ºï¼‰
- æ¶ˆæ¯æ°”æ³¡è¾¹æ¡†å‘¼å¸åŠ¨ç”»ï¼š`pulsing-border` / `chatStreamPulse`
- è¾¹æ¡†é¢œè‰²åœ¨ `border-color` å’Œ `accent` è‰²ä¹‹é—´äº¤æ›¿ï¼Œ1.5s å¾ªç¯
- è¡¨ç¤ºè¿™æ¡æ¶ˆæ¯è¿˜åœ¨è¢« AI æŒç»­è¾“å‡º
- æ¡ä»¶ï¼š`stream.trim().length > 0`ï¼ˆæœ‰å®é™…å†…å®¹ï¼‰

### å…³é”® CSS
```css
/* Reading indicator - ä¸‰åœ†ç‚¹ */
@keyframes chatReadingDot {
    0%, 80%, 100% { opacity: .4; transform: translateY(0) }
    40% { opacity: 1; transform: translateY(-3px) }
}

/* Streaming - è¾¹æ¡†å‘¼å¸ */
@keyframes chatStreamPulse {
    0%, 100% { border-color: var(--border) }
    50% { border-color: var(--accent) }
}
.chat-bubble.streaming {
    animation: chatStreamPulse 1.5s ease-in-out infinite;
}
```

## æˆ‘ä»¬çš„æ–¹æ¡ˆ

### æ¦‚å¿µï¼šåº•éƒ¨æ¸å˜æ³¢åŠ¨æ¡

ä¸æ˜¯æ›¿æ¢ç°æœ‰çš„ä¸‰åœ†ç‚¹æŒ‡ç¤ºå™¨ï¼Œè€Œæ˜¯**åœ¨æ¶ˆæ¯åŒºåŸŸåº•éƒ¨**åŠ ä¸€æ¡æŒç»­æ³¢åŠ¨çš„æ¸å˜å…‰æ¡ï¼Œè¡¨ç¤º"AI è¿˜åœ¨å·¥ä½œä¸­"ã€‚æ¯”ä¸‰ä¸ªè·³åŠ¨åœ†ç‚¹æ›´æœ‰"æ­£åœ¨æŒç»­è¾“å‡º"çš„æ„Ÿè§‰ã€‚

### è§†è§‰æ•ˆæœ

```
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚  ... æ¶ˆæ¯å†…å®¹ ...                â”‚
 â”‚  ... å·¥å…·å¡ç‰‡ ...                â”‚
 â”‚                                 â”‚
 â”‚  ğŸ§  æ€è€ƒè¿‡ç¨‹ â–¶  (æŠ˜å )           â”‚
 â”‚  AI çš„å›å¤å†…å®¹...                â”‚
 â”‚                                 â”‚
 â”‚  Â·Â·Â·  æ‹›è´¢æ­£åœ¨æ€è€ƒ...             â”‚  â† ä¸‰åœ†ç‚¹ï¼ˆä¿ç•™ï¼Œä½†ç²¾ç®€ï¼‰
 â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚  â† åº•éƒ¨æ¸å˜æ³¢åŠ¨æ¡ï¼ˆæ–°å¢ï¼‰
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸¤é˜¶æ®µè®¾è®¡

**é˜¶æ®µ 1ï¼šç­‰å¾…ä¸­ï¼ˆå‘é€å â†’ æ”¶åˆ°ç¬¬ä¸€ä¸ª loadHistory å˜åŒ–å‰ï¼‰**
- ä¸‰åœ†ç‚¹æŒ‡ç¤ºå™¨ï¼ˆä¿ç•™ï¼Œä½†å»æ‰æ–‡å­—ï¼Œåªç•™åœ†ç‚¹ï¼‰
- åº•éƒ¨å…‰æ¡ï¼šä½é€ŸæŸ”å’Œè„‰å†²ï¼Œé¢œè‰²åæš—

**é˜¶æ®µ 2ï¼šè¾“å‡ºä¸­ï¼ˆæ£€æµ‹åˆ° loadHistory æœ‰æ–°å†…å®¹æŒç»­æ›´æ–°ï¼‰**
- ä¸‰åœ†ç‚¹æŒ‡ç¤ºå™¨æ¶ˆå¤±
- åº•éƒ¨å…‰æ¡ï¼šåŠ é€Ÿæ‰«æåŠ¨ç”»ï¼ˆshimmerï¼‰ï¼Œé¢œè‰²æ›´äº®
- æ•´ä¸ªæ¶ˆæ¯åŒºåŸŸåº•éƒ¨æœ‰å¾®å¦™çš„æ¸å˜å‘å…‰

### å…‰æ¡å®ç°

```css
/* åº•éƒ¨æ³¢åŠ¨æŒ‡ç¤ºå™¨ */
.streaming-bar {
    position: sticky;
    bottom: 0;
    height: 3px;
    background: linear-gradient(90deg, 
        transparent, 
        var(--vscode-textLink-foreground, #3794ff) 50%, 
        transparent
    );
    background-size: 200% 100%;
    animation: streaming-shimmer 2s ease-in-out infinite;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.streaming-bar.active {
    opacity: 1;
}

@keyframes streaming-shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}
```

### è§¦å‘æ¡ä»¶

| çŠ¶æ€ | chatRunId | å…‰æ¡ | ä¸‰åœ†ç‚¹ |
|------|-----------|------|--------|
| ç©ºé—² | null | éšè— | éšè— |
| å‘é€ä¸­ | åˆšè®¾ç½® | æ˜¾ç¤ºï¼ˆæ…¢è„‰å†²ï¼‰ | æ˜¾ç¤º |
| AI è¾“å‡ºä¸­ | æœ‰å€¼ + history å˜åŒ– | æ˜¾ç¤ºï¼ˆshimmerï¼‰ | éšè— |
| å®Œæˆ | æ¸…é™¤ | éšè— | éšè— |

### "history å˜åŒ–"æ£€æµ‹

æˆ‘ä»¬çš„ autoRefresh æ˜¯ 2s è½®è¯¢ chat.historyï¼Œé€šè¿‡ `lastHistoryHash` åˆ¤æ–­å†…å®¹æ˜¯å¦å˜åŒ–ã€‚
- å¦‚æœ hash å’Œä¸Šæ¬¡ä¸åŒ â†’ AI åœ¨è¾“å‡ºå†…å®¹ â†’ å…‰æ¡åŠ é€Ÿ
- å¦‚æœ hash è¿ç»­ 3 æ¬¡ç›¸åŒä½† chatRunId è¿˜åœ¨ â†’ AI åœ¨æ€è€ƒ/è°ƒç”¨å·¥å…· â†’ å…‰æ¡æ…¢è„‰å†²
- chatRunId æ¸…ç©º â†’ å…‰æ¡æ·¡å‡ºæ¶ˆå¤±

### DOM ç»“æ„

```html
<!-- åœ¨ messages container åº•éƒ¨ -->
<div id="streamingBar" class="streaming-bar"></div>
```

ä½ç½®ï¼š`position: sticky; bottom: 0;` ç²˜åœ¨æ¶ˆæ¯æ»šåŠ¨åŒºåŸŸåº•éƒ¨ï¼Œæ¶ˆæ¯æ»šåŠ¨ä¸å½±å“å®ƒã€‚

## æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | æ”¹åŠ¨ |
|------|------|
| `webview/main.js` | æ·»åŠ  `showStreamingBar()` / `hideStreamingBar()`ï¼Œåœ¨ chatRunId å˜åŒ–å’Œ refreshComplete æ—¶æ§åˆ¶ |
| `webview/styles.css` | æ–°å¢ `.streaming-bar` å’ŒåŠ¨ç”» |
| `src/chatController.ts` | refreshComplete æ¶ˆæ¯ä¸­åŠ å…¥ `hashChanged` æ ‡å¿— |

## ä¸å…¶ä»–åŠŸèƒ½çš„å…³ç³»

- **ä¸‰åœ†ç‚¹æŒ‡ç¤ºå™¨**ï¼šä¿ç•™ä½†ç²¾ç®€ï¼ˆå»æ‰æ–‡å­—ï¼Œåªä¿ç•™åœ†ç‚¹ï¼‰ï¼ŒAI å¼€å§‹è¾“å‡ºåéšè—
- **Thinking æŠ˜å åŒºåŸŸ**ï¼ˆåˆšåšçš„ï¼‰ï¼šæ— å†²çªï¼Œthinking æ˜¯å†å²æ¶ˆæ¯çš„å±•ç¤ºï¼Œå…‰æ¡æ˜¯å®æ—¶çŠ¶æ€
- **AI å¤´åƒ/æ˜µç§°**ï¼ˆä¸‹ä¸€æ­¥ï¼‰ï¼šæ— å†²çª

## å¤‡é€‰æ–¹æ¡ˆ

### æ–¹æ¡ˆ Bï¼šæ¶ˆæ¯æ°”æ³¡è¾¹æ¡†å‘¼å¸
å’Œ webchat å®Œå…¨ä¸€è‡´ï¼Œæœ€åä¸€æ¡ assistant æ¶ˆæ¯çš„æ°”æ³¡æœ‰ `pulsing-border` åŠ¨ç”»ã€‚
- ä¼˜ç‚¹ï¼šå’Œ webchat ä¸€è‡´
- ç¼ºç‚¹ï¼šæˆ‘ä»¬ç”¨ loadHistory é‡å»º DOMï¼Œæ¯æ¬¡é‡å»ºéƒ½ä¼šé‡ç½®åŠ¨ç”»

### æ–¹æ¡ˆ Cï¼šè¾“å…¥æ¡†ä¸Šæ–¹çŠ¶æ€æ¡
åœ¨è¾“å…¥æ¡†ä¸Šæ–¹æ˜¾ç¤ºä¸€æ¡å¸¦åŠ¨ç”»çš„çŠ¶æ€æ–‡å­—ï¼ˆç±»ä¼¼ GitHub Copilot çš„ "Generating..."ï¼‰
- ä¼˜ç‚¹ï¼šä¸å æ¶ˆæ¯åŒºåŸŸç©ºé—´
- ç¼ºç‚¹ï¼šå¤ªå°ï¼Œå®¹æ˜“å¿½ç•¥

**æ¨èæ–¹æ¡ˆ Aï¼ˆåº•éƒ¨æ¸å˜æ³¢åŠ¨æ¡ï¼‰**ï¼šè§†è§‰å†²å‡»æœ€å¼ºï¼Œå®ç°ç®€å•ï¼Œä¸å— DOM é‡å»ºå½±å“ã€‚
